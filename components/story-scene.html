<template>
  <a-entity>
    <a-entity v-bind:bmfont-text="'text: '+page.actions[0].text+'; opacity:'+pageOpacity"></a-entity>
    <a-collada-model v-bind:src="'assets/'+page.scene+'?'+Math.random()" @click="sceneTouched($event)"></a-collada-model>
  </a-entity>
</template>
<script>
  Vue.component('story-scene', {
    template: document.currentScript.parentNode.querySelector("template").innerHTML,
    props: ["page"],
    data: function(){
      return {
        pageOpacity: 1
      }
    },
    methods: {
      sceneTouched: function(e){
        var intersections = e.detail.cursorEl.components.cursor.intersections;
        var name = intersections[0].object.parent.colladaId;
        console.log("you clicked on "+name);
        for(var i = 0 ; i < this.page.actions.length; i++){
          if(this.page.actions[i].trigger == name){
            this.dispatch("go_to_page",this.page.actions[i].page)
          }
        }
      }
    }
  })
</script>
